/*
SQLyog Ultimate v12.09 (64 bit)
MySQL - 5.5.40 : Database - redbag
*********************************************************************
*/

/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`redbag` /*!40100 DEFAULT CHARACTER SET utf8mb4 */;

USE `redbag`;

/*Table structure for table `bagbyidlog` */

DROP TABLE IF EXISTS `bagbyidlog`;

CREATE TABLE `bagbyidlog` (
  `bagId` bigint(30) NOT NULL,
  `userId` int(11) DEFAULT NULL,
  `nickname` char(40) DEFAULT NULL,
  `getscore` int(20) DEFAULT NULL,
  `winCoin` int(19) DEFAULT NULL,
  `addTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

/*Data for the table `bagbyidlog` */

insert  into `bagbyidlog`(`bagId`,`userId`,`nickname`,`getscore`,`winCoin`,`addTime`) values (9920,794,'xey3638',64,64,'2017-03-23 14:20:21'),(9920,899,'bkx3852',1309,1309,'2017-03-23 14:20:21'),(9920,1498,'qqg3838',763,763,'2017-03-23 14:20:21'),(9920,705,'mhz1546',344,344,'2017-03-23 14:20:21'),(9920,1386,'nrs6987',1455,1455,'2017-03-23 14:20:21'),(9920,1544,'ubu8887',485,485,'2017-03-23 14:20:21'),(9920,918,'azw4564',616,616,'2017-03-23 14:20:21'),(9920,1549,'jtr2868',803,803,'2017-03-23 14:20:21'),(9920,1152,'nbr2111',1036,1036,'2017-03-23 14:20:21'),(9920,1036,'qtw2250',1045,1045,'2017-03-23 14:20:21'),(9921,1524,'jmh0345',712,712,'2017-03-23 14:20:46'),(9921,1040,'irn4747',868,868,'2017-03-23 14:20:46'),(9921,1550,'mqs7721',1568,1568,'2017-03-23 14:20:46'),(9921,1498,'qqg3838',495,-7505,'2017-03-23 14:20:46'),(9921,805,'kyr5681',1384,1384,'2017-03-23 14:20:46'),(9921,899,'bkx3852',867,867,'2017-03-23 14:20:46'),(9921,1547,'hlk6986',122,122,'2017-03-23 14:20:46'),(9921,909,'xcp7078',935,-7065,'2017-03-23 14:20:46'),(9921,705,'mhz1546',288,288,'2017-03-23 14:20:46'),(9921,1163,'sqc4824',681,681,'2017-03-23 14:20:46'),(9922,1524,'jmh0345',94,94,'2017-03-23 14:20:52'),(9922,1550,'mqs7721',608,608,'2017-03-23 14:20:52'),(9922,733,'vkp6573',38,38,'2017-03-23 14:20:52'),(9922,1366,'hdt4130',139,139,'2017-03-23 14:20:52'),(9922,745,'wec9454',420,420,'2017-03-23 14:20:52'),(9922,918,'azw4564',484,484,'2017-03-23 14:20:52'),(9922,1549,'jtr2868',352,352,'2017-03-23 14:20:52'),(9922,976,'qad5469',456,456,'2017-03-23 14:20:52'),(9922,1163,'sqc4824',205,205,'2017-03-23 14:20:52'),(9922,1036,'qtw2250',174,174,'2017-03-23 14:20:52'),(9923,805,'kyr5681',528,528,'2017-03-23 14:21:08'),(9923,918,'azw4564',682,682,'2017-03-23 14:21:08'),(9923,1550,'mqs7721',404,404,'2017-03-23 14:21:08'),(9923,706,'dnf4552',628,628,'2017-03-23 14:21:08'),(9923,794,'xey3638',1042,1042,'2017-03-23 14:21:08'),(9923,617,'lmf5055',709,709,'2017-03-23 14:21:08'),(9923,1547,'hlk6986',181,181,'2017-03-23 14:21:08'),(9923,780,'tjk0718',743,743,'2017-03-23 14:21:08'),(9923,1544,'ubu8887',714,714,'2017-03-23 14:21:08'),(9923,976,'qad5469',309,309,'2017-03-23 14:21:08'),(9924,1386,'nrs6987',21,21,'2017-03-23 14:21:25'),(9924,1550,'mqs7721',117,-383,'2017-03-23 14:21:25'),(9924,899,'bkx3852',10,10,'2017-03-23 14:21:25'),(9924,828,'nzl1488',52,52,'2017-03-23 14:21:25'),(9924,918,'azw4564',85,85,'2017-03-23 14:21:25'),(9924,976,'qad5469',13,13,'2017-03-23 14:21:25'),(9924,1036,'qtw2250',94,94,'2017-03-23 14:21:25'),(9924,794,'xey3638',39,39,'2017-03-23 14:21:25'),(9924,807,'xjb2035',48,48,'2017-03-23 14:21:25'),(9924,1524,'jmh0345',11,11,'2017-03-23 14:21:25'),(9925,1380,'qgk3226',135,135,'2017-03-23 14:21:35'),(9925,1549,'jtr2868',1958,1958,'2017-03-23 14:21:35'),(9925,1386,'nrs6987',497,497,'2017-03-23 14:21:35'),(9925,828,'nzl1488',1035,1035,'2017-03-23 14:21:35'),(9925,1544,'ubu8887',351,-7649,'2017-03-23 14:21:35'),(9925,611,'eok3585',344,344,'2017-03-23 14:21:35'),(9925,1036,'qtw2250',666,666,'2017-03-23 14:21:35'),(9925,705,'mhz1546',1219,1219,'2017-03-23 14:21:35'),(9925,1366,'hdt4130',764,764,'2017-03-23 14:21:35'),(9925,617,'lmf5055',951,-7049,'2017-03-23 14:21:35'),(9926,1524,'jmh0345',1402,1402,'2017-03-23 14:21:49'),(9926,1380,'qgk3226',631,631,'2017-03-23 14:21:49'),(9926,1549,'jtr2868',2919,-17081,'2017-03-23 14:21:49'),(9926,1550,'mqs7721',3682,3682,'2017-03-23 14:21:49'),(9926,1386,'nrs6987',2150,2150,'2017-03-23 14:21:49'),(9926,899,'bkx3852',1264,1264,'2017-03-23 14:21:49'),(9926,733,'vkp6573',3175,3175,'2017-03-23 14:21:49'),(9926,705,'mhz1546',39,-19961,'2017-03-23 14:21:49'),(9926,1547,'hlk6986',1132,1132,'2017-03-23 14:21:49'),(9926,1544,'ubu8887',3406,3406,'2017-03-23 14:21:49'),(9927,733,'vkp6573',192,192,'2017-03-23 14:21:50'),(9927,794,'xey3638',72,72,'2017-03-23 14:21:50'),(9927,1507,'wvl7412',19,-981,'2017-03-23 14:21:50'),(9927,976,'qad5469',153,153,'2017-03-23 14:21:50'),(9927,899,'bkx3852',63,63,'2017-03-23 14:21:50'),(9927,745,'wec9454',20,20,'2017-03-23 14:21:50'),(9927,1386,'nrs6987',167,167,'2017-03-23 14:21:50'),(9927,611,'eok3585',85,85,'2017-03-23 14:21:50'),(9927,1550,'mqs7721',89,-911,'2017-03-23 14:21:50'),(9927,1366,'hdt4130',130,130,'2017-03-23 14:21:50'),(9929,706,'dnf4552',516,516,'2017-03-23 14:22:00'),(9929,1524,'jmh0345',679,679,'2017-03-23 14:22:00'),(9929,1366,'hdt4130',1201,1201,'2017-03-23 14:22:00'),(9929,745,'wec9454',475,475,'2017-03-23 14:22:00'),(9929,918,'azw4564',434,-7566,'2017-03-23 14:22:00'),(9929,705,'mhz1546',1327,1327,'2017-03-23 14:22:00'),(9929,909,'xcp7078',471,471,'2017-03-23 14:22:00'),(9929,617,'lmf5055',701,701,'2017-03-23 14:22:00'),(9929,733,'vkp6573',947,947,'2017-03-23 14:22:00'),(9929,1036,'qtw2250',1169,1169,'2017-03-23 14:22:00'),(9928,706,'dnf4552',8211,8211,'2017-03-23 14:22:01'),(9928,976,'qad5469',5886,5886,'2017-03-23 14:22:01'),(9928,1544,'ubu8887',2038,2038,'2017-03-23 14:22:01'),(9928,1163,'sqc4824',31,31,'2017-03-23 14:22:01'),(9928,1380,'qgk3226',9400,9400,'2017-03-23 14:22:01'),(9928,1524,'jmh0345',1330,1330,'2017-03-23 14:22:01'),(9928,780,'tjk0718',2180,2180,'2017-03-23 14:22:01'),(9928,828,'nzl1488',8685,8685,'2017-03-23 14:22:01'),(9928,705,'mhz1546',6576,6576,'2017-03-23 14:22:01'),(9928,617,'lmf5055',5163,-44837,'2017-03-23 14:22:01'),(9930,661,'wak9587',48,48,'2017-03-23 14:22:36'),(9930,733,'vkp6573',36,-464,'2017-03-23 14:22:36'),(9930,1547,'hlk6986',78,78,'2017-03-23 14:22:36'),(9930,705,'mhz1546',61,61,'2017-03-23 14:22:36'),(9930,1040,'irn4747',33,33,'2017-03-23 14:22:36'),(9930,807,'xjb2035',96,-404,'2017-03-23 14:22:36'),(9930,1163,'sqc4824',8,8,'2017-03-23 14:22:36'),(9930,1498,'qqg3838',88,88,'2017-03-23 14:22:36'),(9930,617,'lmf5055',8,8,'2017-03-23 14:22:36'),(9930,828,'nzl1488',34,34,'2017-03-23 14:22:36'),(9931,706,'dnf4552',1120,1120,'2017-03-23 14:22:49'),(9931,745,'wec9454',978,978,'2017-03-23 14:22:49'),(9931,909,'xcp7078',153,153,'2017-03-23 14:22:49'),(9931,1413,'hss4963',634,634,'2017-03-23 14:22:49'),(9931,617,'lmf5055',533,533,'2017-03-23 14:22:49'),(9931,976,'qad5469',1074,1074,'2017-03-23 14:22:49'),(9931,1295,'fvn1842',556,556,'2017-03-23 14:22:49'),(9931,1040,'irn4747',524,524,'2017-03-23 14:22:49'),(9931,789,'xvk5518',1473,1473,'2017-03-23 14:22:49'),(9931,1544,'ubu8887',875,875,'2017-03-23 14:22:49'),(9932,1547,'hlk6986',12111,12111,'2017-03-23 14:23:03'),(9932,976,'qad5469',1707,1707,'2017-03-23 14:23:03'),(9932,611,'eok3585',1871,1871,'2017-03-23 14:23:03'),(9932,1366,'hdt4130',6247,6247,'2017-03-23 14:23:03'),(9932,899,'bkx3852',3763,-46237,'2017-03-23 14:23:03'),(9932,705,'mhz1546',5054,5054,'2017-03-23 14:23:03'),(9932,789,'xvk5518',5322,5322,'2017-03-23 14:23:03'),(9932,733,'vkp6573',4191,4191,'2017-03-23 14:23:03'),(9932,706,'dnf4552',9017,9017,'2017-03-23 14:23:03'),(9932,909,'xcp7078',217,217,'2017-03-23 14:23:03'),(9933,1163,'sqc4824',3232,-16768,'2017-03-23 14:23:30'),(9933,780,'tjk0718',2765,2765,'2017-03-23 14:23:30'),(9933,705,'mhz1546',2017,2017,'2017-03-23 14:23:30'),(9933,976,'qad5469',3505,3505,'2017-03-23 14:23:30'),(9933,733,'vkp6573',891,891,'2017-03-23 14:23:30'),(9933,617,'lmf5055',204,204,'2017-03-23 14:23:30'),(9933,1423,'yhp1892',2086,2086,'2017-03-23 14:23:30'),(9933,1547,'hlk6986',2159,2159,'2017-03-23 14:23:30'),(9933,1036,'qtw2250',660,660,'2017-03-23 14:23:30'),(9933,1550,'mqs7721',2281,2281,'2017-03-23 14:23:30'),(9935,789,'xvk5518',1948,1948,'2017-03-23 14:23:42'),(9935,1484,'tgx7341',4740,4740,'2017-03-23 14:23:42'),(9935,1366,'hdt4130',12179,12179,'2017-03-23 14:23:42'),(9935,733,'vkp6573',1551,-48449,'2017-03-23 14:23:42'),(9935,1550,'mqs7721',1893,1893,'2017-03-23 14:23:42'),(9935,1040,'irn4747',2529,2529,'2017-03-23 14:23:42'),(9935,1524,'jmh0345',6115,6115,'2017-03-23 14:23:42'),(9935,899,'bkx3852',4725,4725,'2017-03-23 14:23:42'),(9935,1544,'ubu8887',9654,9654,'2017-03-23 14:23:42'),(9935,1413,'hss4963',4166,4166,'2017-03-23 14:23:42'),(9934,733,'vkp6573',18,18,'2017-03-23 14:23:46'),(9934,705,'mhz1546',29,29,'2017-03-23 14:23:46'),(9934,611,'eok3585',5,-95,'2017-03-23 14:23:46'),(9934,794,'xey3638',10,10,'2017-03-23 14:23:46'),(9934,1036,'qtw2250',2,2,'2017-03-23 14:23:46'),(9934,1550,'mqs7721',8,8,'2017-03-23 14:23:46'),(9934,1423,'yhp1892',4,4,'2017-03-23 14:23:46'),(9934,1295,'fvn1842',2,2,'2017-03-23 14:23:46'),(9934,1380,'qgk3226',4,4,'2017-03-23 14:23:46'),(9934,805,'kyr5681',8,8,'2017-03-23 14:23:46'),(9936,976,'qad5469',2601,2601,'2017-03-23 14:24:44'),(9936,1544,'ubu8887',7274,7274,'2017-03-23 14:24:44'),(9936,1547,'hlk6986',1160,1160,'2017-03-23 14:24:44'),(9936,805,'kyr5681',2812,2812,'2017-03-23 14:24:44'),(9936,899,'bkx3852',7123,7123,'2017-03-23 14:24:44'),(9936,780,'tjk0718',7669,7669,'2017-03-23 14:24:44'),(9937,1380,'qgk3226',10830,10830,'2017-03-23 14:24:45'),(9937,1547,'hlk6986',2195,2195,'2017-03-23 14:24:45'),(9937,617,'lmf5055',2405,2405,'2017-03-23 14:24:45'),(9938,828,'nzl1488',2151,2151,'2017-03-23 14:24:46'),(9938,909,'xcp7078',1240,1240,'2017-03-23 14:24:46'),(9938,789,'xvk5518',6146,6146,'2017-03-23 14:24:46'),(9938,780,'tjk0718',5585,5585,'2017-03-23 14:24:46');

/*Table structure for table `baglog` */

DROP TABLE IF EXISTS `baglog`;

CREATE TABLE `baglog` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `redbagId` bigint(20) DEFAULT NULL,
  `sendId` int(11) DEFAULT NULL,
  `coin` int(20) DEFAULT NULL,
  `boom` int(1) DEFAULT NULL,
  `tax` int(19) DEFAULT NULL,
  `count` int(3) DEFAULT NULL,
  `serveId` int(3) DEFAULT NULL,
  `earnings` int(19) DEFAULT '0',
  `addTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9939 DEFAULT CHARSET=utf8mb4;

/*Data for the table `baglog` */

insert  into `baglog`(`id`,`redbagId`,`sendId`,`coin`,`boom`,`tax`,`count`,`serveId`,`earnings`,`addTime`) values (9890,3,1341,1000,6,10,10,41,-10,'2017-03-15 11:41:11'),(9891,4,1542,1000,1,10,10,41,-10,'2017-03-15 11:57:29'),(9892,5,1542,8000,1,80,10,41,-80,'2017-03-15 11:57:58'),(9893,6,1542,8000,2,80,10,41,-80,'2017-03-15 11:58:09'),(9894,7,1542,500,3,10,10,41,-10,'2017-03-15 12:00:52'),(9895,8,1542,3000,4,30,10,41,-30,'2017-03-15 12:01:57'),(9896,9,1359,20000,0,200,10,41,-200,'2017-03-15 12:12:33'),(9897,10,755,100000,5,1000,10,41,-1000,'2017-03-15 12:40:26'),(9898,11,587,20000,1,200,10,41,-200,'2017-03-15 12:52:49'),(9899,12,587,3000,9,30,10,41,-30,'2017-03-15 12:53:46'),(9900,13,587,66000,4,660,10,41,-660,'2017-03-15 12:55:24'),(9901,14,587,20000,4,200,10,41,-200,'2017-03-15 12:57:18'),(9902,15,587,500,7,10,10,41,-10,'2017-03-15 12:58:43'),(9903,16,587,1000,3,10,10,41,-10,'2017-03-15 12:59:42'),(9904,17,587,6000,4,60,10,41,-60,'2017-03-15 13:01:43'),(9905,18,587,8000,7,80,10,41,-80,'2017-03-15 13:07:45'),(9906,19,587,20000,3,200,10,41,-200,'2017-03-15 13:09:39'),(9907,20,734,1000,0,10,10,41,-10,'2017-03-15 13:12:49'),(9908,21,734,66000,9,660,10,41,-660,'2017-03-15 13:17:52'),(9909,22,734,3000,6,30,10,41,-30,'2017-03-15 13:19:39'),(9910,23,779,1000,8,10,10,41,-10,'2017-03-15 13:26:59'),(9911,24,1476,100,3,10,10,41,-10,'2017-03-15 13:34:14'),(9912,25,682,500,8,10,10,41,-10,'2017-03-15 13:38:59'),(9913,26,682,500,1,10,10,41,-10,'2017-03-15 13:40:51'),(9914,27,682,500,8,10,10,41,-10,'2017-03-15 13:45:24'),(9915,28,1275,20000,9,200,10,41,-200,'2017-03-15 13:53:15'),(9916,29,1400,6000,0,60,10,41,-60,'2017-03-15 13:56:55'),(9917,30,1400,100000,1,1000,10,41,-1000,'2017-03-15 13:58:26'),(9918,31,1400,66000,1,660,10,41,-660,'2017-03-15 14:00:38'),(9919,32,1400,100000,8,1000,10,41,-1000,'2017-03-15 14:01:47'),(9920,33,909,8000,1,80,10,41,-8000,'2017-03-23 14:20:06'),(9921,34,828,8000,5,80,10,41,7920,'2017-03-23 14:20:31'),(9922,35,794,3000,7,30,10,41,-3000,'2017-03-23 14:20:42'),(9923,36,807,6000,7,60,10,41,-6000,'2017-03-23 14:20:53'),(9924,37,1498,500,7,10,10,41,0,'2017-03-23 14:21:14'),(9925,38,918,8000,1,80,10,41,7920,'2017-03-23 14:21:26'),(9926,39,617,20000,9,200,10,41,19800,'2017-03-23 14:21:36'),(9927,40,828,1000,9,10,10,41,990,'2017-03-23 14:21:36'),(9928,41,611,50000,3,500,10,41,0,'2017-03-23 14:21:48'),(9929,42,1544,8000,4,80,10,41,0,'2017-03-23 14:21:48'),(9930,43,794,500,6,10,10,41,495,'2017-03-23 14:22:26'),(9931,44,1036,8000,7,80,10,41,-8000,'2017-03-23 14:22:37'),(9932,45,1524,50000,3,500,10,41,0,'2017-03-23 14:22:48'),(9933,46,1380,20000,2,200,10,41,0,'2017-03-23 14:23:18'),(9934,47,661,100,5,10,10,41,0,'2017-03-23 14:23:30'),(9935,48,1547,50000,1,500,10,41,0,'2017-03-23 14:23:31'),(9936,49,733,50000,7,500,10,41,-29139,'2017-03-23 14:23:42'),(9937,50,1366,50000,3,500,10,41,-15930,'2017-03-23 14:23:42'),(9938,51,1550,50000,2,500,10,41,-15622,'2017-03-23 14:23:43');

/*Table structure for table `pool` */

DROP TABLE IF EXISTS `pool`;

CREATE TABLE `pool` (
  `serverId` int(3) NOT NULL,
  `pool` int(10) DEFAULT '0',
  PRIMARY KEY (`serverId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

/*Data for the table `pool` */

/* Procedure structure for procedure `checkRedBag` */

/*!50003 DROP PROCEDURE IF EXISTS  `checkRedBag` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`localhost` PROCEDURE `checkRedBag`(redBagIdx int(30), serveIdx int(4))
BEGIN
	set @id = 0;
	set @sendId = 0;
	set @coin = 0;
	set @boom = 0;
	set @earnings = 0;
	SET @nickname = "";
	SET @url = "";
	select id,sendId,coin,boom,earnings into @id,@sendId,@coin,@boom,@earnings from baglog where serveId = serveId and redbagId = redBagIdx;
	if @id then
		-- select gameaccount.`newuseraccounts`.`nickname`,gameaccount.`newuseraccounts`.`headimgurl` into @nickname,@url from gameaccount.`newuseraccounts` where Id = @sendId;
		-- select *,1 AS rcode from bagbyidlog where bagId = @id;
		set @rcount = 0;
		select count(*) into @rcount FROM bagbyidlog WHERE bagId = @id;
		if @rcount then
			select *,1 as rcode,@sendId as sendId,@coin as sendBagCoin,@boom as boomNum,@earnings as earnings,@nickname as nickname,@url as headimgurl from bagbyidlog where bagId = @id;
		else
			SELECT 2 AS rcode,@sendId AS sendId,@coin AS sendBagCoin,@boom AS boomNum,@earnings AS earnings,@nickname AS nickname,@url AS headimgurl;
		end if;
	else
		select 0 as rcode;
	end if;
    END */$$
DELIMITER ;

/* Procedure structure for procedure `getPool` */

/*!50003 DROP PROCEDURE IF EXISTS  `getPool` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`localhost` PROCEDURE `getPool`(serverIdx int(3))
BEGIN
	select count(*) into @rcode from pool where serverId = serverIdx;
	if @rcode then
		SELECT pool FROM pool WHERE serverId = serverIdx;
	else
		INSERT INTO pool(serverId) VALUE(serverIdx);
		SELECT 0 as pool;
	end if;
    END */$$
DELIMITER ;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
